この手順は、すでにまとめたものをすべてワークフローと呼ばれるもので使用するように設計されています。

ワークフローはエンドツーエンドの自動化オーケストレーションプロセスと考えることができます。これにより、自動化プレイおよびロールを論理フローにリンクして何かを行うことができます。

今回のケースでは、以下のような流れになります。選択された最新の Windows アップデートをインストールします。 IIS のインストール (アドバンス
ロール) を行います。追加パッケージをインストール (chocolatey を使用) します。最後に chocolatey ファクトと設定を確認します。

また、基本的な条件付きロジックを設定し、うまくいかない場合にはロールバック機能などを利用することもできます。

セクション 1 - ワークフローの作成
===============================================

新しいワークフローテンプレートを作成し、そこに既存のオートメーションを追加していきます。

終了時には、以下のようになります。

![ワークフローの例](images/9-win-workflow-0.png)

ステップ 1:
---------------

*Template* に移動し、*Add* をクリックして `Workflow Template`
を選択し、新しいワークフローテンプレートを作成します。

次の値を使用してフォームに記入します

| Key                | Value                      | Note |
|--------------------|----------------------------|------|
| NAME               | Example Workflow           |      |
| DESCRIPTION        | End-to-end process         |      |
| ORGANIZATION       | Default                    |      |
| INVENTORY          | Windows Workshop Inventory |      |
| LIMIT              | windows                    |      |

![ワークフローテンプレートの作成](images/9-win-workflow-1.png)

SAVE ![保存](images/at_save.png) をクリックすると、ワークフロービジュアライザーに入ります。

ステップ 2:
---------------

スタートボックスをクリックし、右側の選択項目から**Windows Update**を選びます。

以下のプロパティーを選択します。

| Key                | Value                      | Note |
|--------------------|----------------------------|------|
| RUN                | Always                     |      |
| CONVERGENCE        | Any                        |      |

![最初のノードの追加](images/9-win-workflow-2.png)

ポップアップで Prompt、Next、および Confirm をクリックします。

メインビジュアライザー画面に戻り、Select をクリックします。

![Workflow Visualizer1](images/9-win-workflow-3.png)

ワークフローの第一段階を追加しました。

**Windows Update** ボックスにカーソルを合わせ、緑色の + をクリックします。

次のステップで、**IIS Advanced** テンプレートを選択します。

以下のプロパティーを選択します。

| Key                | Value                      | Note |
|--------------------|----------------------------|------|
| RUN                | Always                     |      |
| CONVERGENCE        | Any                        |      |

![Workflow Visualizer2](images/9-win-workflow-4.png)

プロンプトをクリックします。

メッセージを Created in our workflow example (または同様の表現) に変更し、ポップアップで Next と
Confirm を押します。

メインビジュアライザー画面に戻り、Select をクリックします。

![Workflow Visualizer3](images/9-win-workflow-5.png)

現在、2 段階のプロセスを採用しています。まず、Windows のアップデートを行い、その後、アップデートがうまくいくか **どうかにかかわらず**
IIS
の詳細インストールを行います。更新がうまくいくかどうかはこの時点では気にしないかもしれませんが、誰かに警告するために失敗したときに通知が発せられるように設定できます。

その他にもアプリケーションデプロイメントの一部を表現してみましょう。

**IIS Advanced** ボックスにカーソルを合わせ、緑色の + をクリックします。

次のステップで、**Chocolatey - Install Packages** テンプレートを選択します。

以下のプロパティーを選択します。

| Key                | Value                      | Note |
|--------------------|----------------------------|------|
| RUN                | On Success                 |      |
| CONVERGENCE        | Any                        |      |

![Workflow Visualizer4](images/9-win-workflow-6.png)

メインビジュアライザー画面に戻り、Select をクリックします。

**Chocolatey - Install Packages** ボックスにカーソルを合わせ、緑色の + をクリックします。

次のボックスで、**Chocolatey - Facts and configuration** テンプレートを選択します。

以下のプロパティーを選択します。

| Key                | Value                      | Note |
|--------------------|----------------------------|------|
| RUN                | On Success                 |      |
| CONVERGENCE        | Any                        |      |

**選択** をクリックします。

![Workflow Visualizer5](images/9-win-workflow-7.png)

**保存** をクリックします。

テンプレート画面に戻ります。ここで **保存** をクリックします。

セクション 2: 新しいワークフローの実行
=======================================================

それを実行して、どのように機能するかを見てみましょう。

ステップ 1:
---------------

テンプレートを選択します

> **注意**
>
> あるいは、テンプレートから移動していない場合
> 作成ページでは、下にスクロールして既存のすべてのテンプレートを表示できます

ステップ 2:
---------------

ワークフローテンプレート **Example Workflow** のロケットシップアイコン
![Add](images/at_launch_icon.png) をクリックします。

ワークフローの起動後は、ワークフローの出力をリアルタイムで確認できます。

すべてが正常に終了すると、以下のような出力が表示されるはずです。

![Workflow Visualizer6](images/9-win-workflow-8.png)
